---
name: quality-checklist
description: |
  生成需求质量检查清单，采用"单元测试 for 需求"的理念，验证需求文档的完整性、清晰性、一致性和可测量性。
  Use when the user wants to validate requirement quality, or mentions '质量检查', 'quality checklist', '需求验证', '检查清单'.
---

# 需求质量检查清单技能

## 核心理念："单元测试 for 需求"

**关键概念**：检查清单是**需求文档的单元测试** - 用于验证需求的质量、清晰度和完整性。

### 检查什么？

**❌ 不是检查实现是否正确**：
- ❌ 不是"验证按钮点击是否正确"
- ❌ 不是"测试错误处理是否工作"
- ❌ 不是"确认API返回200"
- ❌ 不是检查代码/实现是否符合规格

**✅ 而是检查需求质量**：
- ✅ "所有卡片类型的视觉层次需求是否已定义？"（完整性）
- ✅ "'突出显示'是否用具体尺寸/位置量化？"（清晰性）
- ✅ "所有交互元素的悬停状态需求是否一致？"（一致性）
- ✅ "键盘导航的无障碍需求是否已定义？"（覆盖率）
- ✅ "当 logo 图片加载失败时的处理是否已定义？"（边缘情况）

### 比喻

**如果你的规格文档是用中文写的代码，检查清单就是它的单元测试套件。**

你在测试：
- 需求是否写得好
- 需求是否完整
- 需求是否明确
- 需求是否可以被客观验证

你**不是**在测试：
- 实现是否工作正常

---

## 使用场景

### 何时使用

```
产品设计完成
    ↓
生成质量检查清单 ← 使用此 skill
    ↓
人工审核，补充完善需求
    ↓
技术设计开始
```

**时机**：
- 产品设计（PRD）完成后
- 技术设计开始前
- 用于验证需求文档的质量

**目的**：
- 发现需求文档的缺陷和遗漏
- 确保需求清晰、完整、一致
- 减少后续返工

---

## 参数

- 功能名称: {args}（如未提供，询问用户）
- 检查重点: （可选）指定重点检查的领域（如 UX、API、安全等）

---

## 工作流程

### 步骤1：确认功能目录

#### 1.1 查找 feature 目录
- 查找 `docs/specs/feature{N}-specs/` 目录
- 如果未找到，询问用户功能名称

#### 1.2 确认产品设计已完成
- 确认存在 `product/prd/prd.md`
- 确认存在 `product/user-stories/user-stories.md`
- 如果不存在，提示用户先完成产品设计

---

### 步骤2：理解检查重点

#### 2.1 澄清检查重点（最多3个问题）

根据用户输入和文档内容，生成最多3个澄清问题：

**问题类型**：
1. **范围细化**："检查清单应该包含与 X 和 Y 的集成点，还是仅限于本地模块？"
2. **风险优先级**："哪些风险领域应该有强制性检查？"
3. **深度校准**："这是轻量级的提交前检查，还是正式的发布关卡？"
4. **受众定位**："这个清单主要用于作者自检，还是用于 PR 审核？"
5. **边界排除**："是否需要排除性能优化相关的检查项？"

**原则**：
- 只问真正影响清单内容的问题
- 如果用户已经说明，跳过该问题
- 如果无法交互，使用默认值：
  - 深度：标准
  - 受众：审核者（PR）
  - 重点：最相关的2个领域

#### 2.2 确定检查重点

基于澄清结果，确定：
- 检查主题（如：安全、审核、部署、UX）
- 用户明确要求的必检项
- 重点检查的类别

---

### 步骤3：读取文档上下文

#### 3.1 读取 Baseline（理解现有系统）

**必读文档**：
```bash
# 1. 现有架构
cat docs/specs/baseline/tech/architecture.md

# 2. 现有API
cat docs/specs/baseline/tech/api-spec.yaml

# 3. 现有数据库
cat docs/specs/baseline/tech/database.md

# 4. 现有前端
cat docs/specs/baseline/tech/frontend.md
```

**目的**：理解现有系统的约束和规范

#### 3.2 读取 Feature 文档

**必读文档**：
```bash
# 1. 产品需求文档
cat docs/specs/feature{N}-specs/product/prd/prd.md

# 2. 用户故事
cat docs/specs/feature{N}-specs/product/user-stories/user-stories.md

# 3. 原型设计（如果有）
cat docs/specs/feature{N}-specs/product/prototypes/wireframes.md

# 4. 技术设计（如果已有）
cat docs/specs/feature{N}-specs/tech/*.md
```

**加载策略**：
- 只加载与检查重点相关的部分
- 长文档摘要关键点，避免全文加载
- 渐进式加载：发现缺口再补充

---

### 步骤4：生成质量检查清单

#### 4.1 创建目录

```bash
mkdir -p docs/specs/feature{N}-specs/quality/checklists/
```

#### 4.2 生成文件名

根据检查重点生成简短描述性文件名：
- `ux.md` - UX需求质量检查
- `api.md` - API需求质量检查
- `security.md` - 安全需求质量检查
- `performance.md` - 性能需求质量检查
- `general.md` - 通用需求质量检查

**规则**：
- 使用小写英文
- 简短描述性
- 如果文件已存在，生成新名称（如 `ux-2.md`）

#### 4.3 核心原则：测试需求，而非实现

每个检查项必须评估**需求本身**的质量：

**质量维度**：
1. **完整性（Completeness）**：所有必要需求是否都存在？
2. **清晰性（Clarity）**：需求是否明确无歧义？
3. **一致性（Consistency）**：需求之间是否一致？
4. **可测量性（Measurability）**：需求是否可以客观验证？
5. **覆盖率（Coverage）**：所有场景/边缘情况是否都考虑？

#### 4.4 检查清单结构

**分类组织**：
```markdown
## 需求完整性
（检查是否所有必要需求都已文档化）

## 需求清晰性
（检查需求是否具体且无歧义）

## 需求一致性
（检查需求之间是否无冲突）

## 验收标准质量
（检查成功标准是否可测量）

## 场景覆盖率
（检查所有流程/场景是否都考虑）

## 边缘情况覆盖
（检查边界条件是否已定义）

## 非功能需求
（性能、安全、无障碍等是否已明确）

## 依赖和假设
（是否已文档化并验证）

## 歧义和冲突
（需要澄清的内容）
```

#### 4.5 如何编写检查项

**检查项格式**：
```markdown
- [ ] CHK001 - [质量问题的描述？] [质量维度, 引用]
```

**编号规则**：
- 从 CHK001 开始顺序编号
- 全局唯一（跨所有类别）

**引用要求**：
- **至少 80% 的检查项必须包含引用**
- 引用格式：
  - `[PRD §2.3]` - 引用 PRD 的 2.3 章节
  - `[用户故事 #5]` - 引用第5个用户故事
  - `[Gap]` - 标记缺失的需求
  - `[Ambiguity]` - 标记模糊的需求
  - `[Conflict]` - 标记冲突的需求
  - `[Assumption]` - 标记假设

---

### 步骤5：编写检查项示例

#### ✅ 正确的检查项（测试需求质量）

**完整性检查**：
```markdown
- [ ] CHK001 - 所有API失败模式的错误处理需求是否已定义？[Gap]
- [ ] CHK002 - 所有交互元素的无障碍需求是否已明确？[完整性]
- [ ] CHK003 - 响应式布局的移动端断点需求是否已定义？[Gap]
```

**清晰性检查**：
```markdown
- [ ] CHK004 - "快速加载"是否用具体时间阈值量化？[清晰性, PRD §NFR-2]
- [ ] CHK005 - "相关剧集"的选择标准是否明确定义？[清晰性, PRD §FR-5]
- [ ] CHK006 - "突出显示"是否用可测量的视觉属性定义？[Ambiguity, PRD §FR-4]
```

**一致性检查**：
```markdown
- [ ] CHK007 - 所有页面的导航需求是否一致？[一致性, PRD §FR-10]
- [ ] CHK008 - 落地页和详情页的卡片组件需求是否一致？[一致性]
```

**覆盖率检查**：
```markdown
- [ ] CHK009 - 零状态场景（无剧集）的需求是否已定义？[覆盖率, 边缘情况]
- [ ] CHK010 - 并发用户交互场景是否已考虑？[覆盖率, Gap]
- [ ] CHK011 - 部分数据加载失败的需求是否已明确？[覆盖率, 异常流程]
```

**可测量性检查**：
```markdown
- [ ] CHK012 - 视觉层次需求是否可测量/可测试？[验收标准, PRD §FR-1]
- [ ] CHK013 - "平衡的视觉权重"是否可以客观验证？[可测量性, PRD §FR-2]
```

#### ❌ 错误的检查项（测试实现）

**这些是错误的，因为它们测试实现而非需求**：
```markdown
- [ ] 验证落地页显示3个剧集卡片 ❌
- [ ] 测试桌面端悬停状态是否正常工作 ❌
- [ ] 确认 logo 点击导航到首页 ❌
```

**应该改为（测试需求质量）**：
```markdown
- [ ] CHK001 - 精选剧集的确切数量和布局是否已明确？[完整性, PRD §FR-1] ✅
- [ ] CHK002 - 所有交互元素的悬停状态需求是否一致定义？[一致性, PRD §FR-3] ✅
- [ ] CHK003 - 所有可点击品牌元素的导航需求是否明确？[清晰性, PRD §FR-10] ✅
```

---

### 步骤6：场景分类和覆盖

检查需求是否覆盖所有场景类型：

**场景类型**：
1. **主要场景**：核心用户流程
2. **备选场景**：替代路径
3. **异常/错误场景**：出错时的处理
4. **恢复场景**：从错误中恢复
5. **非功能场景**：性能、安全、可用性

**检查方式**：
- 对每种场景类型，问："[场景类型]需求是否完整、清晰、一致？"
- 如果场景类型缺失："[场景类型]需求是否有意排除还是遗漏？[Gap]"
- 如果有状态变更，包含恢复能力："迁移失败的回滚需求是否已定义？[Gap]"

---

### 步骤7：发现和解决问题

检查需求文档本身的问题：

**歧义**：
```markdown
- [ ] CHK015 - 术语"快速"是否用具体指标量化？[Ambiguity, PRD §NFR-1]
```

**冲突**：
```markdown
- [ ] CHK016 - §FR-10 和 §FR-10a 的导航需求是否有冲突？[Conflict]
```

**假设**：
```markdown
- [ ] CHK017 - "播客API始终可用"的假设是否已验证？[Assumption]
```

**依赖**：
```markdown
- [ ] CHK018 - 外部播客API的需求是否已文档化？[Dependency, Gap]
```

**缺失定义**：
```markdown
- [ ] CHK019 - "视觉层次"是否用可测量标准定义？[Gap]
```

---

### 步骤8：优化和整合

#### 8.1 内容整合

**如果候选检查项 > 40**：
- 按风险/影响优先级排序
- 合并检查相同需求方面的近似重复项
- 如果有 >5 个低影响边缘情况，合并为一项：
  ```markdown
  - [ ] CHK020 - 需求中是否考虑了边缘情况 X、Y、Z？[覆盖率]
  ```

#### 8.2 追溯性验证

**确保至少 80% 的检查项有引用**：
- 引用 PRD 章节 `[PRD §X.Y]`
- 引用用户故事 `[用户故事 #N]`
- 或使用标记：`[Gap]`, `[Ambiguity]`, `[Conflict]`, `[Assumption]`

如果没有 ID 系统：
```markdown
- [ ] CHK001 - 是否建立了需求和验收标准的ID方案？[可追溯性]
```

---

### 步骤9：生成文件

#### 9.1 使用模板

基于 `docs/knowledges/templates/quality-templates/checklist-template.md`

**文件结构**：
```markdown
# [功能名称] - [检查重点]质量检查清单

## 元信息

- **功能**: feature{N} - [功能名称]
- **检查重点**: [UX/API/安全/性能/通用]
- **创建日期**: 2026-02-13
- **状态**: 待检查
- **完成率**: 0/[总数] (0%)

## 目的

本检查清单用于验证 [功能名称] 的需求文档质量，采用"单元测试 for 需求"的理念，
检查需求的完整性、清晰性、一致性、可测量性和覆盖率。

**重要**：本清单检查的是**需求本身的质量**，而非实现是否正确。

---

## 需求完整性
[检查项...]

## 需求清晰性
[检查项...]

[其他类别...]

---

## 总结

- **总检查项**: [数量]
- **已完成**: 0
- **未通过**: 0
- **需补充需求**: 0

## 后续行动

根据检查结果：
1. 补充遗漏的需求
2. 澄清模糊的需求
3. 解决冲突的需求
4. 细化粗糙的验收标准
```

#### 9.2 保存文件

```bash
docs/specs/feature{N}-specs/quality/checklists/[domain].md
```

---

### 步骤10：报告结果

输出完整文件路径和摘要：

```markdown
✅ 质量检查清单已生成

**文件位置**: docs/specs/feature{N}-specs/quality/checklists/ux.md

**摘要**:
- 检查重点: UX需求质量
- 检查项总数: 25
- 覆盖类别: 9个质量维度
- 追溯性: 21/25 (84%) 有引用

**检查重点**:
- 需求完整性: 8项
- 需求清晰性: 6项
- 需求一致性: 4项
- 场景覆盖率: 5项
- 其他: 2项

**后续行动**:
1. 产品经理/需求负责人根据清单审查需求文档
2. 补充遗漏的需求和不清晰的定义
3. 解决发现的歧义和冲突
4. 完成检查清单后，可以开始技术设计
```

---

## 🚫 绝对禁止的模式

以下模式使其成为实现测试而非需求测试：

**❌ 禁止的起始词**：
- "验证"、"测试"、"确认"、"检查" + 实现行为
- 引用代码执行、用户操作、系统行为
- "正确显示"、"正常工作"、"符合预期"
- "点击"、"导航"、"渲染"、"加载"、"执行"
- 测试用例、测试计划、QA流程
- 实现细节（框架、API、算法）

**✅ 必需的模式**：
- "是否定义/明确/文档化了 [需求类型] for [场景]？"
- "[模糊术语] 是否用具体标准量化/澄清？"
- "[章节A] 和 [章节B] 之间的需求是否一致？"
- "[需求] 是否可以客观测量/验证？"
- "需求中是否考虑了 [边缘情况/场景]？"
- "规格是否定义了 [缺失方面]？"

---

## 检查清单类型示例

### UX 需求质量：`ux.md`

示例检查项（测试需求，非实现）：

```markdown
- [ ] CHK001 - 视觉层次需求是否用可测量标准定义？[清晰性, PRD §FR-1]
- [ ] CHK002 - UI元素的数量和位置是否明确指定？[完整性, PRD §FR-1]
- [ ] CHK003 - 交互状态需求（悬停、焦点、激活）是否一致定义？[一致性]
- [ ] CHK004 - 所有交互元素的无障碍需求是否已明确？[覆盖率, Gap]
- [ ] CHK005 - 图片加载失败时的降级行为是否已定义？[边缘情况, Gap]
- [ ] CHK006 - "突出显示"是否可以客观测量？[可测量性, PRD §FR-4]
```

### API 需求质量：`api.md`

示例检查项：

```markdown
- [ ] CHK001 - 所有失败场景的错误响应格式是否已明确？[完整性]
- [ ] CHK002 - 速率限制需求是否用具体阈值量化？[清晰性]
- [ ] CHK003 - 所有端点的认证需求是否一致？[一致性]
- [ ] CHK004 - 外部依赖的重试/超时需求是否已定义？[覆盖率, Gap]
- [ ] CHK005 - 版本控制策略是否在需求中文档化？[Gap]
```

### 性能需求质量：`performance.md`

示例检查项：

```markdown
- [ ] CHK001 - 性能需求是否用具体指标量化？[清晰性]
- [ ] CHK002 - 所有关键用户旅程的性能目标是否已定义？[覆盖率]
- [ ] CHK003 - 不同负载条件下的性能需求是否已明确？[完整性]
- [ ] CHK004 - 性能需求是否可以客观测量？[可测量性]
- [ ] CHK005 - 高负载场景的降级需求是否已定义？[边缘情况, Gap]
```

### 安全需求质量：`security.md`

示例检查项：

```markdown
- [ ] CHK001 - 所有受保护资源的认证需求是否已明确？[覆盖率]
- [ ] CHK002 - 敏感信息的数据保护需求是否已定义？[完整性]
- [ ] CHK003 - 威胁模型是否已文档化，需求是否与之对齐？[可追溯性]
- [ ] CHK004 - 安全需求是否与合规义务一致？[一致性]
- [ ] CHK005 - 安全故障/违规响应需求是否已定义？[Gap, 异常流程]
```

---

## 反例：错误的检查项

### ❌ 错误示例（测试实现）

```markdown
- [ ] CHK001 - 验证落地页显示3个剧集卡片 [PRD §FR-001]
- [ ] CHK002 - 测试桌面端悬停状态是否正常工作 [PRD §FR-003]
- [ ] CHK003 - 确认 logo 点击导航到首页 [PRD §FR-010]
- [ ] CHK004 - 检查相关剧集区域显示3-5项 [PRD §FR-005]
```

### ✅ 正确示例（测试需求质量）

```markdown
- [ ] CHK001 - 精选剧集的数量和布局是否明确指定？[完整性, PRD §FR-001]
- [ ] CHK002 - 所有交互元素的悬停状态需求是否一致定义？[一致性, PRD §FR-003]
- [ ] CHK003 - 所有可点击品牌元素的导航需求是否明确？[清晰性, PRD §FR-010]
- [ ] CHK004 - 相关剧集的选择标准是否已文档化？[Gap, PRD §FR-005]
- [ ] CHK005 - 异步剧集数据的加载状态需求是否已定义？[Gap]
- [ ] CHK006 - "视觉层次"需求是否可以客观测量？[可测量性, PRD §FR-001]
```

### 关键差异

| 维度 | 错误的检查项 | 正确的检查项 |
|------|-------------|-------------|
| 检查对象 | 系统是否正确工作 | 需求是否写得正确 |
| 检查类型 | 行为验证 | 需求质量验证 |
| 问题形式 | "是否做了X？" | "X是否明确指定？" |
| 关注点 | 实现 | 文档 |

---

## 质量标准

### 优秀检查清单的特征

✅ **必须满足**：
1. 至少 80% 的检查项有追溯引用
2. 覆盖所有 9 个质量维度
3. 所有检查项都是关于需求质量，而非实现
4. 使用问句形式
5. 包含质量维度标记
6. 按类别组织

✅ **推荐特征**：
1. 15-40 个检查项（太少=不够全面，太多=难以完成）
2. 每个类别至少 2 个检查项
3. 至少 30% 的检查项标记为 [Gap]（发现遗漏）
4. 包含场景覆盖分析
5. 识别歧义、冲突、假设

---

## 使用指南

### 对于产品经理

1. **运行检查清单生成**：在产品设计完成后
2. **逐项审查**：根据清单检查 PRD 和用户故事
3. **补充需求**：对于标记 [Gap] 的项，补充缺失需求
4. **澄清模糊**：对于标记 [Ambiguity] 的项，细化定义
5. **解决冲突**：对于标记 [Conflict] 的项，统一需求
6. **更新文档**：将改进合并到 PRD 中
7. **标记完成**：完成的检查项打勾
8. **进入下阶段**：清单完成率 ≥ 90% 后，可进入技术设计

### 对于技术负责人

1. **审查清单**：检查技术可行性相关的需求
2. **补充技术需求**：非功能需求、约束条件
3. **验证一致性**：确保与 baseline 架构一致
4. **评估风险**：识别技术风险和依赖

---

## 参考资源

- 检查清单模板：`docs/knowledges/templates/quality-templates/checklist-template.md`
- PRD 模板：`docs/knowledges/templates/product-templates/prd-template.md`
- 用户故事模板：`docs/knowledges/templates/product-templates/user-story-template.md`

---

## 总结

**记住核心理念**：

> 检查清单是需求的单元测试。
> 你在测试需求是否写得好，而非测试实现是否工作。

**价值**：
- 提前发现需求缺陷，避免后续返工
- 确保需求清晰完整，减少理解偏差
- 提高需求质量，加速开发进度

**使用时机**：
- 产品设计完成后
- 技术设计开始前
- 作为需求审查的辅助工具
